<!DOCTYPE html>

<html lang="en">
    <head>
        <title>panke.me - Do not Upgrade Your (ve) to Ubuntu 12.04!</title>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="panke.me - Hold my beer; watch this." />
    	<meta name="author" content="R.J. Lorimer" />
		<meta charset="UTF-8" />


    	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    	<!--[if lt IE 9]>
      		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    	<![endif]-->

		<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>
		<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Roboto+Slab' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
		<link href="/stylesheets/syntax-dark.css" rel="stylesheet" />
		<link href="/stylesheets/main.css" rel="stylesheet"/>
    </head>
    <body>
    	<div class="navrow navbar-fixed-top">
	    	<div class="container">
				<div class="navbar navbar-inverse ">
					<a class="navbar-brand" href="/">
						<span class="title_letter">P</span>an<span class="title_letter">k</span>e.me
					</a>

					<ul class="nav navbar-nav ">

                        <li>
                            <a role="menuitem" tabindex="-1" href="/cats_and_tags.html">分类·标签</a>
                        </li>
                        <li class="visible-lg">
                            <a role="menuitem" tabindex="-1" href="/tag/java/">Java Articles</a>
                        </li>
                        <li  class="visible-lg" >
                            <a role="menuitem" tabindex="-1" href="/category/distilling-jruby/">Distilling JRuby Series</a>
                        </li>
                        <li  class="visible-lg" >
                            <a role="menuitem" tabindex="-1" href="/tag/jekyll/">Jekyll Articles</a>
                        </li>
                        <li class="" ><a href="/about.html">关于</a></li>
	                    <!--<li class="dropdown hidden-sm" id="explore">
	                    	<a class="dropdown-toggle" role="button" id="exploredrop" data-toggle="dropdown" href="#">Explore <b class="caret"></b></a>
	                    	<ul class="dropdown-menu" role="menu" aria-labelledby="exploredrop">
                    			<li role="presentation">
                					<a role="menuitem" tabindex="-1" href="/cats_and_tags.html#categories">Categories</a>
                    			</li>
                    			<li role="presentation">
                					<a role="menuitem" tabindex="-1" href="/cats_and_tags.html#tags">Tags</a>
                    			</li>
                    			<li class="divider"></li>
                    			<li role="presentation" >
                					<a role="menuitem" tabindex="-1" href="/tag/java/">Java Articles</a>
                    			</li>
                    			<li role="presentation">
                					<a role="menuitem" tabindex="-1" href="/category/distilling-jruby/">Distilling JRuby Series</a>
                    			</li>
                    			<li role="presentation" >
                					<a role="menuitem" tabindex="-1" href="/tag/jekyll/">Jekyll Articles</a>
                    			</li>
                    		</ul>
	                    </li>-->
	                </ul>

	                <!--<ul class="nav navbar-nav pull-right hidden-sm">
	                    <li class="dropdown" id="elsewhere">
	                    	<a class="dropdown-toggle" role="button" id="elsewheredrop" data-toggle="dropdown" href="#">
	                			Elsewhere <b class="caret"></b>
	                		</a>
	                		<ul class="dropdown-menu" role="menu" aria-labelledby="elsewheredrop">
	                			<li role="presentation">
									<a role="menuitem" tabindex="-1" href="http://www.twitter.com/">Twitter</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="http://www.linkedin.com/in/rjlorimer">LinkedIn</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="https://github.com/">GitHub</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="http://live.xbox.com/en-US/profile/profile.aspx?pp=0&GamerTag=Real+Jenius">XBox Live</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="http://beeradvocate.com/user/profile/">BeerAdvocate</a>
								</li>
							</ul>
						</li>
						<li class="dropdown" id="feeds">
							<a class="dropdown-toggle" role="button" id="feedsdrop" data-toggle="dropdown" href="#">
	                			Feeds <b class="caret"></b>
	                		</a>
	                		<ul class="dropdown-menu" role="menu" aria-labelledby="feedsdrop">
	                			<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="/atom.xml">Everything</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="/category/journal/atom.xml">Journal</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="/category/article/atom.xml">Articles</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="/tag/java/atom.xml">Java</a>
								</li>
								<li role="presentation">
									<a role="menuitem" tabindex="-1"  href="/tag/ruby/atom.xml">Ruby</a>
								</li>
								<li role="presentation">
									<a  role="menuitem" tabindex="-1" href="/tag/linux/atom.xml">Linux</a>
								</li>
							</ul>
						</li>
	  				</ul>-->
				</div>
			</div>
		</div>
		<div class="container main">
			<div class="row sitemap" id="sitemap">
				<div class="col-lg-12">
					<button type="button" class="close" id="sitemapclose">&times;</button>
					<div class="row">
						<div class="col-lg-11 sitemap-section">
							<h4>分类</h4>
							<div class="row">
								 
									<div class="col-lg-3">
										<a href="/category/journal/">journal <span class="badge">20</span></a>
									</div>
								 
									<div class="col-lg-3">
										<a href="/category/notes/">notes <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-3">
										<a href="/category/android/">android <span class="badge">1</span></a>
									</div>
								
							</div>
						</div>
						<div class="col-lg-12 sitemap-section">
							<h4>标签</h4>
							<div class="row">
								 
									<div class="col-lg-2">
										<a href="/tag/funnyordie/">funnyordie <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/humor/">humor <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/personal/">personal <span class="badge">8</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/realjenius.com/">realjenius.com <span class="badge">9</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/finances/">finances <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/mint/">mint <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/quicken/">quicken <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/analytics/">analytics <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/hosting/">hosting <span class="badge">3</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/media temple/">media temple <span class="badge">5</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/(ve)/">(ve) <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/cloudflare/">cloudflare <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/linux/">linux <span class="badge">3</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/ubuntu/">ubuntu <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/gaming/">gaming <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/valve/">valve <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/steam/">steam <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/desktop/">desktop <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/elementaryos/">elementaryos <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/LTS/">LTS <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/EOL/">EOL <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/bootstrap/">bootstrap <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/site/">site <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/css/">css <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/mediatemple/">mediatemple <span class="badge">2</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/php/">php <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/framework/">framework <span class="badge">1</span></a>
									</div>
								 
									<div class="col-lg-2">
										<a href="/tag/android/">android <span class="badge">1</span></a>
									</div>
								
							</div>
						</div>							
					</div>
				</div>
			</div>
			
			<div class="row">
	<div class="col-lg-12" id="content">
		<article class="page">
	<div class="page-header">
		<h2 class="entry-title"><a href="/journal/2013/02/06/media-temple-ve-and-ubuntu-1204.html">Do not Upgrade Your (ve) to Ubuntu 12.04!</a>
			
		</h2>
        <small>
                <span class="entry-date">2013-02-06</span>
        </small>
	</div>

	<div class="article-body">
		<div class="row">
			<div class="col-lg-12">
				<div class="article-body">
					<p>A quick scan of my site shows that I’m typically one of <a href="http://www.mediatemple.net">Media Temple’s</a> <a href="/tag/media%20temple/">biggest supporters</a>. Their customer service is prompt, friendly, and their technological offering is always very stout for the price.</p>

<p>However, for the past little bit, I have been battling a rather unfortunate situation (which admittedly is not all their fault) regarding Ubuntu upgrades and their (ve) servers. My site currently runs on a <a href="http://mediatemple.net/webhosting/ve/">Media Temple (ve)</a> hosting virtualized Ubuntu 10.04.4 LTS. I had been doing regular upgrades and dist-upgrades on this environment without fail, but I hit an issue where some of the packages in the Lucid Apt repos were just getting a little long in the tooth. I generally use Ruby, Nginx, and a few other things out there that have a tendency to move pretty quickly on their upgrades, and individual releases generally don’t introduce the major/minor package version upgrades of the sort that might happen with some of these components. Two and a half years can be a long time when it’s a server for a hobbyist exploring a lot of new tech.</p>

<p>Now, I do know that with Ubuntu’s community, you can inevitably dig up somebody who has a PPA that can be tied to your respective LTS install to individually bring in packages up to a newer version than that particular major release ships, but inevitably those are supported less effectively than the mainline distro packages, and there’s also a spidering of trust it results in, where you being relying on more than just “official” community package maintainers. This is, in fact, what I’ve had to do, however.</p>

<p>Choosing to leave the LTS wasn’t a huge deal for me anyway, as this is my personal server; not some commercially-hosted product. So, I decided to do the magical <code>do-release-upgrade</code> to level-up. Whoops.</p>

<p>Earlier last year if you decided to do a release-upgrade on Media Temple (ve)s with “normal” as your release profile (as specified in the <code>/etc/update-manager/release-upgrades</code> file), it would upgrade you to 10.10, and everything was shiny. You could then upgrade to 11.04, and even to 11.10. No problems.</p>

<p>However, if you tried to go to 12.04, the upgrade bombed very, very badly. In short, <a href="http://askubuntu.com/questions/146610/why-does-upgrading-to-12-04-on-an-openvz-vps-warn-that-the-kernel-size-is-0">this is the error I received</a>.</p>

<blockquote>
  <p>Please check your current kernel version with uname -r. If it is less than 2.6.24, the upgrade will fail half-way with a glibc error. That happens because the glibc included by default with 12.04 requires a minimum 2.6.24 kernel – glibc are the critical C libraries used by every application.</p>
</blockquote>

<p>Yup - sure enough, just as this link indicates, MediaTemple runs an <a href="http://openvz.org/Main_Page">OpenVZ</a>-based virtualization by <a href="http://www.parallels.com/">Parallels</a>. Here’s my <code>uname -r</code>:</p>

<pre><code>2.6.18-028stab101.1
</code></pre>

<p>Uh-oh. 2.6.18 is definitely not 2.6.24. The forum Q&amp;A above suggests a rather ominous pinned dependency for <code>glibc</code>. I tried this temporarily, but never got it to work, and decided that it was not something I wanted to be shimmed on my server long-term anyway, so I went back to 10.04.</p>

<p><em>(Incidentally, this isn’t discussed much, but if an Ubuntu upgrade fails, you better have a spare boat handy, as this one is going to sink, and no bailing of water will help. It’s very difficult to do anything resembling a rollback without just restoring a backup. So be prepared!)</em></p>

<p>Now, something else happened shortly after 12.10 Ubuntu came out last year that made all of this muddier for Media Temple Ubuntinians. While 10.10 has been EOL for a while, it hasn’t actually been moved off of the main APT sources, so doing a “normal” upgrade would work as you’d expect. Through some administrative cleanup (I presume), it’s now properly under “old-releases” on the Ubuntu site. So if you try to upgrade from 10.04 LTS to 10.10 with <code>do-release-upgrade</code> and a normal upgrade setting, you will get a rather obscure 404 error. Worse, because Lucid isn’t actually in the EOL package tree for standard builds (because it’s not EOL), the general recommendation for upgrades fails (<a href="https://help.ubuntu.com/community/EOLUpgrades">see here</a>). In short, they recommend you to:</p>

<ol>
  <li>Move your current release sources to old-releases</li>
  <li>Do a full “update+upgrade” to get caught up</li>
  <li>Perform the do-upgrade-release to the next version, which may be EOL.</li>
</ol>

<p>This doesn’t work, as step-2 throws 404 errors. Now, I suspect so long as you did a full update before moving this over (flip steps one and two) it probably would work. But it feels rather unpleasant, and inevitably you’ll still hit 11.10 and have to stop. So now you’ve upgraded to a more recent build, but you’re no longer on an LTS release, and instead are on a release that will likely sunset in April, 2013, with nowhere to go.</p>

<p><strong>Even worse</strong> for most (ve) folks is the fact that the default upgade process is not to do a “normal” release, but to do an LTS upgrade on 10.04 now that 12.04 is out. So if you login to your Media Temple instance, it will suggest you upgrade to Precise, and if you do -<strong>BOOM</strong>- trashed install. I made that mistake as well during this process.</p>

<p>So in short, 10.04 LTS is probably the best you can do on a (ve) without doing some less-than-ideal workarounds, and the kernel is going to be 2.6.18 until Media Temple straightens it out.</p>

<p>To describe how old 2.6.18 actually is, 2.6.16 (just 2 patches prior) came out in <em>March of 2006</em>. 2.6.27, which came out over a year after was, at release, a long-term-support kernel for Linux - and even that was EOL’ed back in early 2012.</p>

<p>Now, to defend Media Temple a little bit, Ubuntu 10.04 LTS is still in active support, and will be for some time. So my distro is totally acceptable, even if the (admittedly, heavily patched and customized) kernel their virtualization uses is EOL. Also, from what I’ve been able to determine, this was originally a problem with Parallels, and not Media Temple. Unfortunately, it’s been something of a lacking priority for them, or at least not very transparent that it was a priority. Here is a forum thread that’s been going on since shortly after 12.04 went live: <a href="https://forum.mediatemple.net/topic/6345-ve-ubuntu-1204-lts/">Ubuntu 12.04 LTS on Media Temple (ve)</a>.</p>

<p>Here are the most recent updates from Media Temple - November 6th of last year:</p>

<blockquote>
  <p>We still don’t have a time frame as to when Ubuntu 12.04 LTS will be available for the (ve) Servers.  The ‘technical obstacle’ is we are bringing in a whole new infrastructure for our (ve) Servers.  I apologize for the inconvenience but this is all the information I have for you at the moment.</p>
</blockquote>

<p>… and on January 11th this year:</p>

<blockquote>
  <p>Hey there! Apologize for the inconvenience but we currently don’t have any update on when Ubuntu 12.04 LTS will be available.</p>
</blockquote>

<p>I even decided to bring this up with the Media Temple twitter team, and got a similar non-commital response unfortunately: <a href="https://twitter.com/realjenius/status/298973645991182337">https://twitter.com/realjenius/status/298973645991182337</a>.</p>

<p>But, even with bad news comes good. The main reason for the delay seems to be that they are working on some rather large (and non-descript) infrastructural change for the (ve) servers. The one huge benefit so far is that they doubled their RAM offering for all (ve) tiers, and existing customers were allowed to upgrade with a simple push of a button. So I guess I shouldn’t complain too much!</p>

				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-5 col-offset-7">
				
				<div class="post-details">
	分类:
		
			
				<a href="/category/journal"><span class="label">journal</span></a>
			
		
	|
	标签:
		
			
				<a href="/tag/hosting"><span class="label">hosting</span></a>
			
				<a href="/tag/media temple"><span class="label">media temple</span></a>
			
				<a href="/tag/LTS"><span class="label">LTS</span></a>
			
				<a href="/tag/EOL"><span class="label">EOL</span></a>
			
		
	|
	<a href="http://panke.me/journal/2013/02/06/media-temple-ve-and-ubuntu-1204.html"><span class="label label-info">Permalink</span></a>
</div>


			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<div id="disqus_thread"></div>
				<!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="" data-title="" data-url=""></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"panke"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- 多说公共JS代码 end -->
			</div>
		</div>
	</div>
</article>
	</div>
</div>

	    </div>
		<footer class="rjfooter">
			<div class="container">
				<div class="row">
					<div class="col-lg-6 col-offset-3">
						<p>&copy 2016-2017 - panke.me | Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a> &amp; <a href="http://github.com" target="_blank">GitHub</a></p>
						
					</div>
				</div>
			</div>
		</footer>
		<script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-27375996-1']);
            _gaq.push(['_trackPageview']);

            (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();

        </script>
        <script type="text/javascript" src="/js/jquery-2.0.3.min.js"></script>
        <script type="text/javascript" src="/js/bootstrap.min.js"></script>
        <script type="text/javascript">
        	$(document).ready(function() {
    			$("#sitemapbtn").click(function() {
					$("#sitemap").slideToggle();
					return false;
    			});
    			$("#sitemapclose").click(function() {
    				$("#sitemap").slideUp();
    				return false;
    			});
        	});
        </script>
    </body>
</html>
